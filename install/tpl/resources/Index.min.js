
jQuery.Class("Install_Index_Js",{},{registerEventForStep1:function(){jQuery(".bt_install").on("click",function(a){jQuery('input[name="mode"]').val("Step2");jQuery('form[name="step1"]').submit()});jQuery(".bt_migrate").on("click",function(a){jQuery('input[name="mode"]').val("mStep0");jQuery('form[name="step1"]').submit()})},registerEventForStep3:function(){jQuery("#recheck").on("click",function(){window.location.reload()});jQuery('input[name="step4"]').on("click",function(b){var a=jQuery(".no");if(a.length>0){var c=app.vtranslate("LBL_PHP_WARNING");if(confirm(c)){jQuery('form[name="step3"]').submit();return true}else{return false}}jQuery('form[name="step3"]').submit()})},checkPwdEvent:function(){var a=this;jQuery('input[name="password"]').on("blur",function(){a.checkPwd(jQuery(this).val())})},checkPwd:function(b){var a=false;if(b.length<8){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_TO_SHORT"));a=true}else{if(b.length>32){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_TO_LONG"));a=true}else{if(b.search(/\d/)==-1){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_NO_NUM"));a=true}else{if(b.search(/[A-Z]/)==-1){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_LACK_OF_CAPITAL_LETTERS"));a=true}else{if(b.search(/[a-z]/)==-1){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_LACK_OF_LOWERCASE_LETTERS"));a=true}}}}}return a},registerEventForStep4:function(){var b=JSON.parse(localStorage.getItem("yetiforce_install"));for(var e in b){var d=jQuery('[name="'+e+'"]');if("SELECT"==jQuery(d).prop("tagName")){jQuery(d).val(b[e]);jQuery(d).select2("destroy");jQuery(d).select2()}else{if("INPUT"==jQuery(d).prop("tagName")&&"checkbox"==jQuery(d).attr("type")){if(true==b[e]){jQuery(d).prop("checked",true);jQuery(".config-table tr.hide").removeClass("hide")}}else{jQuery(d).val(b[e])}}}var c=this;jQuery('input[name="create_db"]').on("click",function(){var h=jQuery("#root_user");var g=jQuery("#root_password");if(jQuery(this).is(":checked")){h.removeClass("hide");g.removeClass("hide")}else{h.addClass("hide");g.addClass("hide")}});function f(){jQuery("#passwordError").html("")}function a(){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_REENTER_ERROR"))}jQuery('input[name="retype_password"]').on("blur",function(i){var h=jQuery(i.currentTarget);var g=jQuery('input[name="password"]').val();if(g!==h.val()){a()}});jQuery('input[name="password"]').on("blur",function(h){var g=jQuery('input[name="retype_password"]');if(g.val()!=""&&g.val()!==jQuery(h.currentTarget).val()){jQuery("#passwordError").html(app.vtranslate("LBL_PASS_REENTER_ERROR"))}else{f()}});jQuery('input[name="retype_password"]').on("keypress",function(g){f()});jQuery('input[name="step5"]').on("click",function(){var j=false;var g=["db_hostname","db_username","db_name","password","retype_password","lastname","admin_email"];for(var r in g){var o=jQuery('input[name="'+g[r]+'"]');if(o.val()==""){o.addClass("error").focus();j=true;break}else{o.removeClass("error")}}var s=jQuery('input[name="create_db"]:checked');if(s.length>0){var m=jQuery('input[name="db_root_username"]');if(m.val()==""){m.addClass("error").focus();j=true}else{m.removeClass("error")}}var p=jQuery("#passwordError");if(p.html().trim()){j=true}var q=jQuery('input[name="admin_email"]');var l=false;var n=/^[_/a-zA-Z0-9*]+([!"#$%&'()*+,./:;<=>?\^_`{|}~-]?[a-zA-Z0-9/_/-])*@[a-zA-Z0-9]+([\_\-\.]?[a-zA-Z0-9]+)*\.([\-\_]?[a-zA-Z0-9])+(\.?[a-zA-Z0-9]+)?$/;if(!n.test(q.val())&&q.val()!=""){l=true;q.addClass("error").focus();j=true}else{q.removeClass("error")}var k=false;k=c.checkPwd(jQuery('input[name="password"]').val());if(k){j=true}if(j){var i;if(l){i='<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="invalidEmailError"]').val()+"</div></div>"}else{if(k){i='<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="insufficientlyStrongPassword"]').val()+"</div></div>"}else{i='<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+app.vtranslate("LBL_MANDATORY_FIELDS_ERROR")+"</div></div>"}}jQuery("#errorMessage").html(i).show()}else{var h={db_hostname:document.step4.db_hostname.value,db_username:document.step4.db_username.value,db_name:document.step4.db_name.value,create_db:jQuery('[name="create_db"]').prop("checked"),db_root_username:document.step4.db_root_username.value,currency_name:document.step4.currency_name.value,firstname:document.step4.firstname.value,lastname:document.step4.lastname.value,admin_email:document.step4.admin_email.value,dateformat:document.step4.dateformat.value,timezone:document.step4.timezone.value};window.localStorage.setItem("yetiforce_install",JSON.stringify(h));jQuery('form[name="step4"]').submit()}});this.checkPwdEvent()},registerEventForStep5:function(){jQuery('input[name="step6"]').on("click",function(){var a=jQuery("#errorMessage");if(a.length){alert(app.vtranslate("LBL_RESOLVE_ERROR"));return false}else{jQuery("#progressIndicator").removeClass("hide");jQuery('form[name="step5"]').submit().hide()}})},registerEventForStep6:function(){jQuery('input[name="step7"]').on("click",function(){if($('form[name="step6"]').validationEngine("validate")){jQuery("#progressIndicator").show().removeClass("hide");jQuery('form[name="step6"]').submit().hide()}})},registerEventForMigration:function(){var a=jQuery('input[name="mode"]').val();if(a=="mStep3"){jQuery("form").on("submit",function(){jQuery("#progressIndicator").show();jQuery("#mainContainer").hide()})}},changeLanguage:function(b){var a=$(b.currentTarget);jQuery('input[name="mode"]').val("");jQuery('form[name="step1"]').submit()},registerEvents:function(){jQuery('input[name="back"]').on("click",function(){var a=jQuery('input[name="create_db"]:checked');if(a.length>0){jQuery('input[name="create_db"]').removeAttr("checked")}window.history.back()});jQuery("form").validationEngine(app.validationEngineOptions);this.registerEventForStep1();this.registerEventForStep3();this.registerEventForStep4();this.registerEventForStep5();this.registerEventForStep6();this.registerEventForMigration();$('select[name="lang"]').change(this.changeLanguage)}});jQuery(document).ready(function(){var a=new Install_Index_Js();a.registerEvents()});